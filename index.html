
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FÃªnix 2026 â€“ Elite Ranking</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        // â•â• ğŸ”¥ COLE SEU firebaseConfig AQUI â•â•
        const firebaseConfig = {
            apiKey:            "AIzaSyBCFPX0gknfN0CgIoC_4dWiJDg6Rnz0LqI",
            authDomain:        "fenixdooeste.firebaseapp.com",
            databaseURL:       "https://fenixdooeste-default-rtdb.firebaseio.com",
            projectId:         "fenixdooeste",
            storageBucket:     "fenixdooeste.firebasestorage.app",
            messagingSenderId: "276140570126",
            appId:             "1:276140570126:web:a0af6a3a76ccf70977ae5f",
            measurementId:     "G-WYDR7PTP9N"
        };

        const app = initializeApp(firebaseConfig);
        const db  = getDatabase(app);

        window._fbSet    = (path, data) => set(ref(db, path), data);
        window._fbGet    = (path)       => get(ref(db, path)).then(s => s.exists() ? s.val() : null);
        window._fbListen = (path, cb)   => onValue(ref(db, path), snap => cb(snap.exists() ? snap.val() : null));
        window._firebaseReady = true;
        window.dispatchEvent(new Event('firebaseReady'));
    </script>
    <style>
        :root {
            --bg: #1e293b;
            --header-dark: #0f172a;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --success-dark: #059669;
            --primary: #6366f1;
            --reno: #f97316;
            --a5pro: #06b6d4;
        }

        * { box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f1f5f9; margin: 0; padding-bottom: 50px; color: #1e293b; }

        /* â”€â”€ HEADER â”€â”€ */
        header {
            background: var(--header-dark);
            color: white;
            padding: 12px 24px 0;
            display: flex;
            flex-direction: column;
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .logo-placeholder { font-size: 22px; }
        header h1 { font-size: 18px; font-weight: 800; margin: 0; letter-spacing: -0.5px; text-align: center; flex-grow: 1; }
        .header-buttons { display: flex; align-items: center; gap: 6px; }

        .btn-hdr {
            border: none; padding: 7px 13px; border-radius: 6px; font-weight: 700;
            cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 4px;
            transition: all 0.2s; font-family: inherit;
        }
        .btn-hdr-ghost { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.15); }
        .btn-hdr-ghost:hover { background: rgba(255,255,255,0.18); }
        .btn-hdr-primary { background: var(--primary); color: white; }
        .btn-hdr-primary:hover { background: #4f46e5; }
        .btn-hdr-chart { background: #0f766e; color: white; }
        .btn-hdr-chart:hover { background: #0d9488; }

        /* â”€â”€ MONTH TABS â”€â”€ */
        .month-tabs { display: flex; gap: 2px; padding: 0 4px; overflow-x: auto; scrollbar-width: none; }
        .month-tabs::-webkit-scrollbar { display: none; }
        .month-tab {
            background: none; border: none; border-bottom: 3px solid transparent;
            color: #64748b; padding: 8px 12px 9px; font-size: 10px; font-weight: 800;
            cursor: pointer; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.18s;
            letter-spacing: 0.6px; text-transform: uppercase; white-space: nowrap; flex-shrink: 0;
        }
        .month-tab:hover { color: #cbd5e1; border-bottom-color: #334155; }
        .month-tab.active { color: white; border-bottom-color: var(--primary); }

        /* â”€â”€ CONTAINER â”€â”€ */
        .container { max-width: 1000px; margin: 0 auto; padding: 0 15px; }

        /* â”€â”€ BANNER â”€â”€ */
        .premium-banner-wrap { position: relative; margin: 20px auto; max-width: 700px; }
        .premium-banner {
            background: white; border: 2px dashed #3b82f6; border-radius: 12px;
            padding: 12px 44px 12px 12px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .premium-banner h2 { font-size: 13px; margin: 0; color: #1e40af; font-weight: 900; text-transform: uppercase; }
        .premium-banner p { font-size: 12px; margin: 5px 0 0; font-weight: 700; color: #3b82f6; }
        .btn-banner-edit {
            position: absolute; top: 8px; right: 8px;
            background: #eff6ff; border: 1px solid #bfdbfe; color: #3b82f6;
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 13px; transition: all 0.2s;
        }
        .btn-banner-edit:hover { background: #dbeafe; }
        .banner-popover {
            display: none; position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
            background: white; border: 1px solid #e2e8f0; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12); padding: 16px; width: 380px; z-index: 500;
        }
        .banner-popover.open { display: block; }
        .banner-popover label { font-size: 10px; font-weight: 800; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .banner-popover input, .banner-popover textarea {
            width: 100%; border: 1px solid #e2e8f0; border-radius: 7px;
            padding: 8px 10px; font-size: 12px; font-family: inherit; margin-bottom: 10px; resize: none;
        }
        .banner-popover-btns { display: flex; gap: 8px; }
        .btn-pop-save   { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 700; font-size: 11px; cursor: pointer; flex: 1; font-family: inherit; }
        .btn-pop-cancel { background: none; border: 1px solid #e2e8f0; color: #64748b; padding: 8px 16px; border-radius: 6px; font-weight: 700; font-size: 11px; cursor: pointer; font-family: inherit; }

        /* â”€â”€ STATS â”€â”€ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(175px, 1fr)); gap: 12px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); text-align: center; border-bottom: 4px solid #e2e8f0; }
        .stat-card .label { font-size: 9px; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 4px; }
        .stat-card .big-number { font-size: 26px; font-weight: 900; display: block; margin: 2px 0; }
        .stat-card .footer-label { font-size: 11px; font-weight: 700; }

        /* â”€â”€ PROMOTOR CARDS â”€â”€ */
        .promotor-card {
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            display: grid; grid-template-columns: 44px 1.2fr 2fr 1.2fr;
            align-items: center; gap: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); border-left: 6px solid #eee;
        }
        .rank-badge { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 900; flex-shrink: 0; }
        .rank-1 { background: linear-gradient(135deg, #fef9c3, #fde68a); color: #92400e; box-shadow: 0 2px 8px rgba(251,191,36,0.45); }
        .rank-2 { background: linear-gradient(135deg, #f1f5f9, #cbd5e1); color: #475569; box-shadow: 0 2px 8px rgba(148,163,184,0.4); }
        .rank-3 { background: linear-gradient(135deg, #fef3e2, #fed7aa); color: #9a3412; box-shadow: 0 2px 8px rgba(251,146,60,0.4); }
        .rank-n { background: #f1f5f9; color: #94a3b8; font-size: 13px; }
        .p-name { font-weight: 800; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-capa { font-size: 10px; font-weight: 800; color: #64748b; background: #f1f5f9; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-top: 3px; }
        .progress-bg { height: 10px; background: #f1f5f9; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.8s ease; }
        .pct-label { font-size: 9px; font-weight: 900; margin-top: 4px; }
        .meta-group { display: flex; justify-content: space-around; text-align: center; }
        .m-item span { display: block; font-size: 9px; font-weight: 800; color: #94a3b8; text-transform: uppercase; }
        .m-item b { font-size: 15px; font-weight: 900; }

        /* â”€â”€ MODAIS BASE â”€â”€ */
        .modal-overlay {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(15, 23, 42, 0.95); z-index: 2000; overflow-y: auto; padding: 20px 0;
        }

        /* â”€â”€ MODAL GESTÃƒO â”€â”€ */
        .modal-content { background: white; max-width: 900px; margin: auto; padding: 25px; border-radius: 15px; }
        .edit-row { display: grid; grid-template-columns: 2fr 0.7fr 0.7fr 0.7fr 0.7fr 1.3fr 40px; gap: 6px; margin-bottom: 8px; }
        .edit-row input { padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%; font-size: 11px; font-family: inherit; }
        .btn-save { background: var(--success-dark); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: 800; cursor: pointer; font-family: inherit; font-size: 13px; }

        /* â”€â”€ MODAL PAINEL â”€â”€ */
        .painel-content { background: white; max-width: 960px; margin: auto; padding: 24px 28px; border-radius: 15px; }
        .painel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .painel-title { font-size: 16px; font-weight: 900; color: #0f172a; }
        .painel-sub { font-size: 11px; font-weight: 700; color: #64748b; margin-top: 2px; }
        .btn-print { background: var(--primary); color: white; border: none; padding: 9px 18px; border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px; font-family: inherit; }
        .btn-fechar-painel { background: none; border: 1px solid #e2e8f0; color: #64748b; padding: 9px 18px; border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 12px; font-family: inherit; }
        .painel-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .painel-table thead tr { background: #0f172a; color: white; }
        .painel-table thead th { padding: 8px 10px; font-weight: 800; font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; text-align: center; }
        .painel-table thead th:first-child { text-align: left; }
        .painel-table tbody tr { border-bottom: 1px solid #f1f5f9; }
        .painel-table tbody tr:hover { background: #f8fafc; }
        .painel-table tbody td { padding: 8px 10px; text-align: center; vertical-align: middle; }
        .painel-table tbody td:first-child { text-align: left; font-weight: 700; font-size: 12px; }
        .pct-cell { font-weight: 900; font-size: 12px; padding: 3px 8px; border-radius: 5px; display: inline-block; }
        .pct-verde    { background: #dcfce7; color: #166534; }
        .pct-amarelo  { background: #fef9c3; color: #92400e; }
        .pct-vermelho { background: #fee2e2; color: #991b1b; }
        .painel-totais td { background: #f8fafc; font-weight: 900; font-size: 12px; border-top: 2px solid #e2e8f0; }

        /* â”€â”€ MODAL GRÃFICOS â”€â”€ */
        .graficos-content { background: white; max-width: 960px; margin: auto; padding: 24px 28px; border-radius: 15px; }
        .graficos-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .graficos-title { font-size: 16px; font-weight: 900; color: #0f172a; }
        .graficos-tabs { display: flex; gap: 6px; margin-bottom: 24px; flex-wrap: wrap; }
        .graf-tab {
            background: #f1f5f9; border: none; color: #64748b; padding: 8px 16px;
            border-radius: 8px; font-size: 11px; font-weight: 800; cursor: pointer;
            font-family: inherit; transition: all 0.18s; letter-spacing: 0.3px;
        }
        .graf-tab:hover { background: #e2e8f0; }
        .graf-tab.active { background: var(--primary); color: white; }
        .graf-panel { display: none; }
        .graf-panel.active { display: block; }
        .chart-wrap { position: relative; height: 340px; }
        .chart-wrap-sm { position: relative; height: 260px; }

        /* Cards de destaque nos grÃ¡ficos */
        .insight-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .insight-card { background: #f8fafc; border-radius: 10px; padding: 12px; border-left: 4px solid #e2e8f0; }
        .insight-card .i-label { font-size: 9px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 4px; }
        .insight-card .i-val { font-size: 20px; font-weight: 900; }
        .insight-card .i-name { font-size: 13px; font-weight: 800; color: #1e293b; margin-top: 4px; line-height: 1.3; }

        @media print {
            body * { visibility: hidden; }
            #painelModal, #painelModal * { visibility: visible; }
            #painelModal { position: absolute; top: 0; left: 0; background: white; padding: 0; }
            .painel-content { border-radius: 0; box-shadow: none; padding: 16px; }
            .btn-print, .btn-fechar-painel { display: none; }
        }

        @media (max-width: 768px) {
            .promotor-card { grid-template-columns: 44px 1fr; }
            .promotor-card > div:nth-child(3),
            .promotor-card > div:nth-child(4) { grid-column: 1 / -1; }
            header h1 { font-size: 14px; }
            .banner-popover { width: calc(100vw - 40px); }
            .graficos-content, .painel-content, .modal-content { padding: 16px; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="header-left">
            <span class="logo-placeholder">ğŸ¦…</span>
            <span id="syncStatus" style="font-size:10px;font-weight:700;transition:opacity 1s;opacity:0;"></span>
        </div>
        <h1>FÃŠNIX DO OESTE â€” <span id="mesAtual"></span></h1>
        <div class="header-buttons">
            <button class="btn-hdr btn-hdr-chart"   onclick="openGraficos()">ğŸ“Š</button>
            <button class="btn-hdr btn-hdr-primary"  onclick="openPainel()">ğŸ“‹ PAINEL</button>
            <button class="btn-hdr btn-hdr-ghost"    onclick="openModal()">âš™ï¸ EQUIPE</button>
        </div>
    </div>
    <div class="month-tabs" id="monthTabs">
        <button class="month-tab" onclick="selecionarMes(0)">JAN</button>
        <button class="month-tab" onclick="selecionarMes(1)">FEV</button>
        <button class="month-tab" onclick="selecionarMes(2)">MAR</button>
        <button class="month-tab" onclick="selecionarMes(3)">ABR</button>
        <button class="month-tab" onclick="selecionarMes(4)">MAI</button>
        <button class="month-tab" onclick="selecionarMes(5)">JUN</button>
        <button class="month-tab" onclick="selecionarMes(6)">JUL</button>
        <button class="month-tab" onclick="selecionarMes(7)">AGO</button>
        <button class="month-tab" onclick="selecionarMes(8)">SET</button>
        <button class="month-tab" onclick="selecionarMes(9)">OUT</button>
        <button class="month-tab" onclick="selecionarMes(10)">NOV</button>
        <button class="month-tab" onclick="selecionarMes(11)">DEZ</button>
    </div>
</header>

<div class="container">

    <div class="premium-banner-wrap">
        <div class="premium-banner">
            <h2 id="bannerTitulo">ğŸ† PREMIAÃ‡ÃƒO ESPECIAL: LINHA RENO + A5 PRO</h2>
            <p  id="bannerDesc">6 a 10 aparelhos: <b>+ R$ 50,00</b> | 11 ou mais: <b>+ R$ 100,00 por unidade</b></p>
        </div>
        <button class="btn-banner-edit" onclick="toggleBannerEdit(event)" title="Editar banner">âœï¸</button>
        <div class="banner-popover" id="bannerPopover">
            <label>TÃ­tulo do Banner</label>
            <input type="text" id="bannerTituloInput" placeholder="TÃ­tulo da premiaÃ§Ã£o">
            <label>DescriÃ§Ã£o</label>
            <textarea id="bannerDescInput" rows="2" placeholder="Regras e valores..."></textarea>
            <div class="banner-popover-btns">
                <button class="btn-pop-cancel" onclick="closeBannerEdit()">Cancelar</button>
                <button class="btn-pop-save"   onclick="saveBanner()">Salvar</button>
            </div>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card" style="border-bottom-color:var(--primary);">
            <div class="label">REALIZADO EQUIPE</div>
            <span id="realGeral" class="big-number">0</span>
            <div class="footer-label" style="color:var(--primary);">Meta: <span id="metaGeralLabel">629</span></div>
        </div>
        <div class="stat-card" style="border-bottom-color:var(--primary);">
            <div class="label">ATINGIMENTO GERAL</div>
            <span id="pctGeral" class="big-number" style="color:var(--primary);">0%</span>
            <div class="footer-label" style="color:#64748b;">% da meta da equipe</div>
        </div>
        <div class="stat-card" style="border-bottom-color:var(--reno);">
            <div class="label">RENO VENDIDOS</div>
            <span id="renoGeral" class="big-number" style="color:var(--reno);">0</span>
            <div class="footer-label">Meta: <span id="metaRenoLabel">69</span></div>
        </div>
        <div class="stat-card" style="border-bottom-color:var(--a5pro);">
            <div class="label">A5 PRO VENDIDOS</div>
            <span id="a5Geral" class="big-number" style="color:var(--a5pro);">0</span>
            <div class="footer-label">Meta: <span id="metaA5Label">69</span></div>
        </div>
        <div class="stat-card" style="border-bottom-color:var(--success);">
            <div class="label">MARKET SHARE</div>
            <span id="marketGeral" class="big-number">0%</span>
            <div class="footer-label" style="color:var(--success);">Real Ã· CAPA total</div>
        </div>
        <div class="stat-card" style="border-bottom-color:var(--danger);">
            <div class="label">DIÃRIA NECESSÃRIA</div>
            <span id="diariaEquipe" class="big-number" style="color:var(--danger);">0</span>
            <div class="footer-label">Vendas/dia Ãºtil restante</div>
        </div>
    </div>

    <div id="listaPromotores"></div>
</div>

<!-- â•â• MODAL GESTÃƒO â•â• -->
<div id="editModal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="margin:0 0 4px;font-size:18px;">ConfiguraÃ§Ã£o da Equipe</h2>
        <p style="margin:0 0 15px;font-size:12px;color:#64748b;font-weight:600;">
            MÃªs: <span id="modalMesLabel" style="color:var(--primary);font-weight:800;"></span>
        </p>
        <!-- â”€â”€ METAS GERAIS DO MÃŠS â”€â”€ -->
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;">
            <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
                <div style="font-size:9px;font-weight:800;color:#6366f1;text-transform:uppercase;margin-bottom:6px;">ğŸ¯ Meta Geral da Equipe</div>
                <input type="number" id="metaGeralInput" min="0"
                    style="width:100%;border:1.5px solid #6366f1;border-radius:6px;padding:7px 10px;font-size:15px;font-weight:900;color:#6366f1;font-family:inherit;text-align:center;">
            </div>
            <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
                <div style="font-size:9px;font-weight:800;color:#f97316;text-transform:uppercase;margin-bottom:6px;">ğŸ”¥ Meta Reno</div>
                <input type="number" id="metaRenoInput" min="0"
                    style="width:100%;border:1.5px solid #f97316;border-radius:6px;padding:7px 10px;font-size:15px;font-weight:900;color:#f97316;font-family:inherit;text-align:center;">
            </div>
            <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
                <div style="font-size:9px;font-weight:800;color:#06b6d4;text-transform:uppercase;margin-bottom:6px;">ğŸ’ Meta A5 Pro</div>
                <input type="number" id="metaA5Input" min="0"
                    style="width:100%;border:1.5px solid #06b6d4;border-radius:6px;padding:7px 10px;font-size:15px;font-weight:900;color:#06b6d4;font-family:inherit;text-align:center;">
            </div>
        </div>
        <div style="display:grid;grid-template-columns:2fr 0.7fr 0.7fr 0.7fr 0.7fr 1.3fr 40px;gap:6px;padding:8px;font-weight:bold;font-size:10px;color:#64748b;text-align:center;background:#f8fafc;border-radius:6px;">
            <div style="text-align:left;">NOME</div><div>CAPA</div><div>META</div><div>REAL</div><div>RENO</div>
            <div style="color:var(--a5pro);">LINHA A PRO</div><div></div>
        </div>
        <div id="formLista" style="margin-top:10px;"></div>
        <button onclick="addRow()" style="margin:15px 0;padding:10px;cursor:pointer;width:100%;border:1px dashed #cbd5e1;border-radius:8px;background:#f8fafc;font-weight:700;font-family:inherit;">
            + Adicionar Promotor
        </button>
        <button class="btn-save" onclick="saveAll()">SALVAR E ATUALIZAR</button>
        <button onclick="closeModal()" style="background:none;border:none;color:#64748b;width:100%;margin-top:10px;cursor:pointer;font-size:12px;font-family:inherit;">
            Cancelar
        </button>
    </div>
</div>

<!-- â•â• MODAL PAINEL GERAL â•â• -->
<div id="painelModal" class="modal-overlay">
    <div class="painel-content">
        <div class="painel-header">
            <div>
                <div class="painel-title">ğŸ¦… PAINEL GERAL â€” FÃŠNIX DO OESTE &nbsp;<span id="painelMes" style="color:var(--primary)"></span></div>
                <div class="painel-sub">Atualizado conforme dados da GestÃ£o de Equipe</div>
            </div>
            <div style="display:flex;gap:8px;">
                <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ IMPRIMIR</button>
                <button class="btn-fechar-painel" onclick="closePainel()">âœ• Fechar</button>
            </div>
        </div>
        <div id="painelTabela"></div>
    </div>
</div>

<!-- â•â• MODAL GRÃFICOS â•â• -->
<div id="graficosModal" class="modal-overlay">
    <div class="graficos-content">
        <div class="graficos-header">
            <div>
                <div class="graficos-title">ğŸ“Š ANÃLISE DE PERFORMANCE â€” <span id="graficosMes" style="color:var(--primary)"></span></div>
                <div class="painel-sub">VisÃ£o analÃ­tica da equipe FÃªnix do Oeste</div>
            </div>
            <button class="btn-fechar-painel" onclick="closeGraficos()">âœ• Fechar</button>
        </div>

        <div class="graficos-tabs">
            <button class="graf-tab active" onclick="switchTab('performance')">ğŸ† Performance</button>
            <button class="graf-tab" onclick="switchTab('atencao')">âš ï¸ AtenÃ§Ã£o</button>
            <button class="graf-tab" onclick="switchTab('produtos')">ğŸ“¦ Produtos</button>
        </div>

        <!-- TAB: PERFORMANCE -->
        <div id="tab-performance" class="graf-panel active">
            <div class="insight-grid" id="insightPerf"></div>
            <div class="chart-wrap"><canvas id="chartPerformance"></canvas></div>
        </div>

        <!-- TAB: ATENÃ‡ÃƒO -->
        <div id="tab-atencao" class="graf-panel">
            <div class="insight-grid" id="insightAtencao"></div>
            <div class="chart-wrap"><canvas id="chartAtencao"></canvas></div>
        </div>

        <!-- TAB: PRODUTOS -->
        <div id="tab-produtos" class="graf-panel">
            <div class="insight-grid" id="insightProd"></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:8px;">
                <div>
                    <div style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;margin-bottom:10px;">Vendas por produto â€” equipe</div>
                    <div class="chart-wrap-sm"><canvas id="chartProdDonut"></canvas></div>
                </div>
                <div>
                    <div style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;margin-bottom:10px;">Reno + A5 por promotor</div>
                    <div class="chart-wrap-sm"><canvas id="chartProdBar"></canvas></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONSTANTES & DADOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const meses = ["JANEIRO","FEVEREIRO","MARÃ‡O","ABRIL","MAIO","JUNHO","JULHO","AGOSTO","SETEMBRO","OUTUBRO","NOVEMBRO","DEZEMBRO"];
const STORAGE_PREFIX = 'fenixData2026_mes_';

const defaultPromotores = () => [
    {nome:"Erika Aparecida Maneia De Oliveira", capa:367, meta:55,  real:0, reno:0, a5:0},
    {nome:"NÃºbia De CÃ¡ssia Viana",              capa:200, meta:40,  real:0, reno:0, a5:0},
    {nome:"Thais Almeida Otoni",                capa:321, meta:50,  real:0, reno:0, a5:0},
    {nome:"Dabila Jormane Souza Silva",         capa:195, meta:33,  real:0, reno:0, a5:0},
    {nome:"Elias Andrade De Almeida Alves",     capa:309, meta:43,  real:0, reno:0, a5:0},
    {nome:"Diego De Souza Alle",                capa:323, meta:45,  real:0, reno:0, a5:0},
    {nome:"Dennas Pereira Prates",              capa:290, meta:46,  real:0, reno:0, a5:0},
    {nome:"Isaac Magno Soares De Souza",        capa:248, meta:45,  real:0, reno:0, a5:0},
    {nome:"Erika Priscila Razzano Da Silva",    capa:279, meta:42,  real:0, reno:0, a5:0},
    {nome:"Gabriela Borges De Oliveira",        capa:253, meta:40,  real:0, reno:0, a5:0},
    {nome:"Taynara Roberta Ferreira",           capa:280, meta:39,  real:0, reno:0, a5:0},
    {nome:"Nicole Victoria De Souza Soares",    capa:234, meta:35,  real:0, reno:0, a5:0},
    {nome:"Marcos Vinicius Joseph Dos Santos",  capa:380, meta:53,  real:0, reno:0, a5:0},
    {nome:"Thais De CÃ¡ssia Rezende Silva",      capa:200, meta:32,  real:0, reno:0, a5:0},
    {nome:"Beatriz Diniz GonÃ§alves",            capa:193, meta:31,  real:0, reno:0, a5:0},
    {nome:"Ãlax felicidade",                    capa:1,   meta:0,   real:0, reno:0, a5:0}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STORAGE POR MÃŠS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadMesData(mesIdx) {
    // Tenta localStorage como cache imediato, Firebase sincroniza em seguida
    const saved = localStorage.getItem(STORAGE_PREFIX + mesIdx);
    if (saved) return JSON.parse(saved);
    if (mesIdx === new Date().getMonth()) {
        const legado = localStorage.getItem('fenixData2026_Final');
        if (legado) return JSON.parse(legado);
    }
    return { metaGeral:629, metaReno:69, metaA5:69, promotores: defaultPromotores() };
}
function saveMesData(mesIdx, data) {
    // Salva local imediatamente (UX rÃ¡pida)
    localStorage.setItem(STORAGE_PREFIX + mesIdx, JSON.stringify(data));
    // Salva na nuvem Firebase
    if (window._fbSet) {
        window._fbSet('fenix2026/mes_' + mesIdx, data)
            .then(() => showSyncStatus('âœ… Salvo na nuvem', 'verde'))
            .catch(() => showSyncStatus('âš ï¸ Salvo sÃ³ local', 'amarelo'));
    }
}
function showSyncStatus(msg, tipo) {
    let el = document.getElementById('syncStatus');
    if (!el) return;
    el.textContent = msg;
    el.style.color = tipo === 'verde' ? '#10b981' : '#f59e0b';
    el.style.opacity = '1';
    setTimeout(() => el.style.opacity = '0', 3000);
}
// Carrega dados do Firebase ao iniciar e quando muda
function setupFirebaseSync() {
    if (!window._fbListen) return;
    for (let m = 0; m < 12; m++) {
        (function(mesIdx) {
            window._fbListen('fenix2026/mes_' + mesIdx, (data) => {
                if (!data) return;
                localStorage.setItem(STORAGE_PREFIX + mesIdx, JSON.stringify(data));
                if (mesIdx === mesSelecionado) {
                    fenixData = data;
                    render();
                }
            });
        })(m);
    }
    // Banner
    window._fbListen('fenix2026/banner', (data) => {
        if (!data) return;
        bannerData = data;
        renderBanner();
        localStorage.setItem('fenixBanner2026', JSON.stringify(data));
    });
}

let mesSelecionado = new Date().getMonth();
let fenixData = loadMesData(mesSelecionado);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SELEÃ‡ÃƒO DE MÃŠS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selecionarMes(idx) {
    mesSelecionado = idx;
    fenixData = loadMesData(idx);
    atualizarHeaderTexto();
    document.querySelectorAll('.month-tab').forEach((btn, i) => btn.classList.toggle('active', i === idx));
    render();
}

function atualizarHeaderTexto() {
    const ano = new Date().getFullYear();
    const label = meses[mesSelecionado] + " " + ano;
    document.getElementById('mesAtual').innerText = label;
    document.getElementById('metaGeralLabel').innerText = fenixData.metaGeral || 629;
    document.getElementById('metaRenoLabel').innerText  = fenixData.metaReno  || 69;
    document.getElementById('metaA5Label').innerText    = fenixData.metaA5    || 69;
    const ml = document.getElementById('modalMesLabel');
    if (ml) ml.innerText = label;
}

atualizarHeaderTexto();
document.querySelectorAll('.month-tab').forEach((btn, i) => btn.classList.toggle('active', i === mesSelecionado));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FÃ“RMULAS CORRIGIDAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Dias Ãºteis restantes no mÃªs SELECIONADO (excl. domingos).
 * Se for mÃªs futuro/passado: retorna total de dias Ãºteis do mÃªs.
 * Se for mÃªs atual: conta de hoje atÃ© fim do mÃªs (inclui hoje).
 */
function getDiasUteisRestantes() {
    const hoje    = new Date();
    const ano     = hoje.getFullYear();
    const mesAtual = hoje.getMonth();
    const ultimoDia = new Date(ano, mesSelecionado + 1, 0); // Ãºltimo dia do mÃªs selecionado

    let inicio;
    if (mesSelecionado === mesAtual) {
        // MÃªs corrente: conta de hoje atÃ© fim
        inicio = new Date(ano, mesSelecionado, hoje.getDate());
    } else {
        // Outro mÃªs: conta mÃªs inteiro (Ãºtil para calcular diÃ¡ria histÃ³rica/futura)
        inicio = new Date(ano, mesSelecionado, 1);
    }

    let count = 0;
    for (let d = new Date(inicio); d <= ultimoDia; d.setDate(d.getDate() + 1)) {
        if (d.getDay() !== 0) count++; // exclui apenas domingo (sÃ¡bado Ã© dia Ãºtil)
    }
    return Math.max(count, 1); // nunca zero para nÃ£o dividir por zero
}

/**
 * Total de dias Ãºteis no mÃªs (independente de hoje).
 */
function getTotalDiasUteisDoMes(mesIdx) {
    const ano = new Date().getFullYear();
    const ultimo = new Date(ano, mesIdx + 1, 0);
    let count = 0;
    for (let d = new Date(ano, mesIdx, 1); d <= ultimo; d.setDate(d.getDate() + 1)) {
        if (d.getDay() !== 0) count++;
    }
    return Math.max(count, 1);
}

/**
 * DiÃ¡ria necessÃ¡ria: (meta - real) / dias_Ãºteis_restantes
 * Resultado arredondado para cima, mÃ­nimo 0.
 */
function calcDiaria(meta, real, diasRestantes) {
    if (!meta || meta <= 0) return 0;
    const falta = meta - real;
    if (falta <= 0) return 0;
    return Math.ceil(falta / diasRestantes);
}

/**
 * % de atingimento: real / meta * 100, arredondado p/ cima. Min 0.
 */
function calcPct(real, meta) {
    if (!meta || meta <= 0) return 0;
    return Math.ceil((real / meta) * 100);
}

/**
 * Score de ranking: prioriza % atingido, penaliza diÃ¡ria alta.
 * Promotores sem meta ficam no fim.
 */
function scoreRanking(p, dias) {
    if (!p.meta || p.meta === 0) return -Infinity;
    const pct    = (p.real / p.meta) * 100;
    const diaria = calcDiaria(p.meta, p.real, dias);
    return pct - (diaria * 5);
}

/**
 * Classifica risco do promotor:
 * Verde  = pct >= 80% ou diÃ¡ria <= 1
 * Amarelo = pct >= 50%
 * Vermelho = pct < 50%
 */
function getRisco(pct, diaria) {
    if (pct >= 80 || diaria <= 1) return 'verde';
    if (pct >= 50) return 'amarelo';
    return 'vermelho';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BANNER EDITÃVEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let bannerData = JSON.parse(localStorage.getItem('fenixBanner2026')) || {
    titulo: 'ğŸ† PREMIAÃ‡ÃƒO ESPECIAL: LINHA RENO + A5 PRO',
    desc:   '6 a 10 aparelhos: <b>+ R$ 50,00</b> | 11 ou mais: <b>+ R$ 100,00 por unidade</b>'
};
function renderBanner() {
    document.getElementById('bannerTitulo').innerHTML = bannerData.titulo;
    document.getElementById('bannerDesc').innerHTML   = bannerData.desc;
}
renderBanner();
function toggleBannerEdit(e) {
    e.stopPropagation();
    const pop = document.getElementById('bannerPopover');
    if (!pop.classList.contains('open')) {
        document.getElementById('bannerTituloInput').value = bannerData.titulo.replace(/<[^>]*>/g,'');
        document.getElementById('bannerDescInput').value   = bannerData.desc.replace(/<b>|<\/b>/g,'');
        pop.classList.add('open');
    } else { pop.classList.remove('open'); }
}
function closeBannerEdit() { document.getElementById('bannerPopover').classList.remove('open'); }
function saveBanner() {
    bannerData.titulo = document.getElementById('bannerTituloInput').value;
    bannerData.desc   = document.getElementById('bannerDescInput').value;
    localStorage.setItem('fenixBanner2026', JSON.stringify(bannerData));
    if (window._fbSet) window._fbSet('fenix2026/banner', bannerData);
    renderBanner(); closeBannerEdit();
}
document.addEventListener('click', e => {
    const pop = document.getElementById('bannerPopover');
    if (pop.classList.contains('open') && !pop.contains(e.target) && !e.target.classList.contains('btn-banner-edit'))
        pop.classList.remove('open');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL GESTÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal() {
    document.getElementById('editModal').style.display = 'block';
    document.getElementById('modalMesLabel').innerText = meses[mesSelecionado] + " " + new Date().getFullYear();
    document.getElementById('metaGeralInput').value = fenixData.metaGeral || 629;
    document.getElementById('metaRenoInput').value  = fenixData.metaReno  || 69;
    document.getElementById('metaA5Input').value    = fenixData.metaA5    || 69;
    renderForm();
}
function renderForm() {
    let html = "";
    fenixData.promotores.forEach((p, i) => {
        html += `<div class="edit-row">
            <input type="text"   value="${p.nome}" id="n_${i}">
            <input type="number" value="${p.capa}" id="c_${i}" min="0">
            <input type="number" value="${p.meta}" id="m_${i}" min="0">
            <input type="number" value="${p.real}" id="r_${i}" min="0">
            <input type="number" value="${p.reno}" id="re_${i}" min="0">
            <input type="number" value="${p.a5}"   id="a_${i}" min="0">
            <button onclick="removeRow(${i})" style="border:none;background:none;color:#ef4444;cursor:pointer;font-size:18px;">Ã—</button>
        </div>`;
    });
    document.getElementById('formLista').innerHTML = html;
}
function addRow()     { fenixData.promotores.push({nome:"",capa:0,meta:0,real:0,reno:0,a5:0}); renderForm(); }
function removeRow(i) { fenixData.promotores.splice(i,1); renderForm(); }
function closeModal() { document.getElementById('editModal').style.display = 'none'; }
function saveAll() {
    fenixData.metaGeral = parseInt(document.getElementById('metaGeralInput').value) || 629;
    fenixData.metaReno  = parseInt(document.getElementById('metaRenoInput').value)  || 69;
    fenixData.metaA5    = parseInt(document.getElementById('metaA5Input').value)    || 69;
    fenixData.promotores = fenixData.promotores.map((p,i) => ({
        nome: document.getElementById(`n_${i}`).value,
        capa: parseInt(document.getElementById(`c_${i}`).value)  || 0,
        meta: parseInt(document.getElementById(`m_${i}`).value)  || 0,
        real: parseInt(document.getElementById(`r_${i}`).value)  || 0,
        reno: parseInt(document.getElementById(`re_${i}`).value) || 0,
        a5:   parseInt(document.getElementById(`a_${i}`).value)  || 0
    }));
    saveMesData(mesSelecionado, fenixData);
    closeModal();
    render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL PAINEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openPainel() {
    const ano  = new Date().getFullYear();
    const dias = getDiasUteisRestantes();
    document.getElementById('painelMes').innerText = meses[mesSelecionado] + " " + ano;

    const sorted    = [...fenixData.promotores].sort((a,b) => scoreRanking(b,dias) - scoreRanking(a,dias));
    const realTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.real)||0), 0);
    const renoTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.reno)||0), 0);
    const a5Total   = fenixData.promotores.reduce((a,b) => a+(parseInt(b.a5)||0),   0);
    const capaTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.capa)||0), 0);
    const metaTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.meta)||0), 0);
    const pctTotal  = calcPct(realTotal, metaTotal);

    const rankEmoji = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    let medalIdx = 0, rows = "";
    sorted.forEach((p,idx) => {
        const semMeta  = !p.meta || p.meta === 0;
        const pct      = calcPct(p.real, p.meta);
        const dRest    = calcDiaria(p.meta, p.real, dias);
        const pctClass = pct >= 100 ? 'pct-verde' : pct >= 50 ? 'pct-amarelo' : 'pct-vermelho';
        const medal    = semMeta ? 'â€”' : (medalIdx < 3 ? rankEmoji[medalIdx++] : `${idx+1}Âº`);
        if (!semMeta && medalIdx <= 3 && medal !== 'â€”') {} // medalIdx jÃ¡ incrementado acima
        rows += `<tr>
            <td>${medal} ${p.nome}</td><td>${p.capa}</td><td>${p.meta}</td><td>${p.real}</td>
            <td><span class="pct-cell ${pctClass}">${pct}%</span></td>
            <td>${p.reno}</td><td>${p.a5}</td><td>${dRest}</td>
        </tr>`;
    });

    const pctTotalClass = pctTotal >= 100 ? 'pct-verde' : pctTotal >= 50 ? 'pct-amarelo' : 'pct-vermelho';
    document.getElementById('painelTabela').innerHTML = `
        <table class="painel-table">
            <thead><tr>
                <th>Promotor</th><th>Capa</th><th>Meta</th><th>Real</th>
                <th>Ating.%</th><th>Reno</th><th>A5 Pro</th><th>DiÃ¡ria</th>
            </tr></thead>
            <tbody>${rows}
                <tr class="painel-totais">
                    <td>EQUIPE TOTAL</td>
                    <td>${capaTotal}</td><td>${metaTotal}</td><td>${realTotal}</td>
                    <td><span class="pct-cell ${pctTotalClass}">${pctTotal}%</span></td>
                    <td>${renoTotal}</td><td>${a5Total}</td>
                    <td>${calcDiaria(fenixData.metaGeral, realTotal, dias)}</td>
                </tr>
            </tbody>
        </table>`;
    document.getElementById('painelModal').style.display = 'block';
}
function closePainel() { document.getElementById('painelModal').style.display = 'none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL GRÃFICOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chartInstances = {};

function destroyChart(id) {
    if (chartInstances[id]) { chartInstances[id].destroy(); delete chartInstances[id]; }
}

function openGraficos() {
    document.getElementById('graficosMes').innerText = meses[mesSelecionado] + " " + new Date().getFullYear();
    document.getElementById('graficosModal').style.display = 'block';
    switchTab('performance');
}
function closeGraficos() {
    document.getElementById('graficosModal').style.display = 'none';
    ['chartPerformance','chartAtencao','chartProdDonut','chartProdBar'].forEach(destroyChart);
}

function switchTab(tab) {
    document.querySelectorAll('.graf-tab').forEach((t,i) => {
        const tabs = ['performance','atencao','produtos'];
        t.classList.toggle('active', tabs[i] === tab);
    });
    document.querySelectorAll('.graf-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');

    setTimeout(() => {
        if (tab === 'performance') buildChartPerformance();
        if (tab === 'atencao')     buildChartAtencao();
        if (tab === 'produtos')    buildChartProdutos();
    }, 50);
}

function primeiroNome(nome) {
    const partes = nome.trim().split(' ').filter(Boolean);
    if (partes.length === 1) return partes[0];
    return partes[0] + ' ' + partes[1];
}

// â”€â”€ GRÃFICO PERFORMANCE â”€â”€
function buildChartPerformance() {
    destroyChart('chartPerformance');
    const dias    = getDiasUteisRestantes();
    const comMeta = fenixData.promotores.filter(p => p.meta > 0);
    const sorted  = [...comMeta].sort((a,b) => scoreRanking(b,dias) - scoreRanking(a,dias));
    const top     = sorted.slice(0,10); // top 10

    const labels  = top.map(p => primeiroNome(p.nome));
    const pcts    = top.map(p => calcPct(p.real, p.meta));
    const colors  = pcts.map(p => p >= 100 ? '#10b981' : p >= 70 ? '#6366f1' : p >= 50 ? '#f59e0b' : '#ef4444');

    // Insights
    const melhor = sorted[0];
    const maisVendas = [...comMeta].sort((a,b) => b.real - a.real)[0];
    document.getElementById('insightPerf').innerHTML = `
        <div class="insight-card" style="border-left-color:#10b981;">
            <div class="i-label">ğŸ† Maior atingimento</div>
            <div class="i-val" style="color:#10b981;">${calcPct(melhor?.real,melhor?.meta)}%</div>
            <div class="i-name">${melhor ? primeiroNome(melhor.nome) : 'â€”'}</div>
        </div>
        <div class="insight-card" style="border-left-color:#6366f1;">
            <div class="i-label">ğŸ“¦ Maior volume</div>
            <div class="i-val" style="color:#6366f1;">${maisVendas?.real || 0}</div>
            <div class="i-name">${maisVendas ? primeiroNome(maisVendas.nome) : 'â€”'}</div>
        </div>
        <div class="insight-card" style="border-left-color:#f59e0b;">
            <div class="i-label">âœ… Acima de 80%</div>
            <div class="i-val" style="color:#f59e0b;">${comMeta.filter(p=>calcPct(p.real,p.meta)>=80).length}</div>
            <div class="i-name">promotores</div>
        </div>
        <div class="insight-card" style="border-left-color:#ef4444;">
            <div class="i-label">ğŸ¯ Atingiram 100%</div>
            <div class="i-val" style="color:#ef4444;">${comMeta.filter(p=>p.real>=p.meta).length}</div>
            <div class="i-name">promotores</div>
        </div>`;

    chartInstances['chartPerformance'] = new Chart(
        document.getElementById('chartPerformance'),
        {
            type: 'bar',
            data: {
                labels,
                datasets: [{
                    label: '% Atingimento',
                    data: pcts,
                    backgroundColor: colors,
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => ` ${ctx.parsed.y}% da meta`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: Math.max(120, ...pcts),
                        ticks: { callback: v => v + '%', font: { size: 10 } },
                        grid: { color: '#f1f5f9' }
                    },
                    x: {
                        ticks: { font: { size: 10 } },
                        grid: { display: false }
                    }
                }
            }
        }
    );
}

// â”€â”€ GRÃFICO ATENÃ‡ÃƒO â”€â”€
function buildChartAtencao() {
    destroyChart('chartAtencao');
    const dias   = getDiasUteisRestantes();
    const comMeta = fenixData.promotores.filter(p => p.meta > 0);

    // Risco: vermelho = pct < 50%, amarelo = 50-79%
    const vermelhos = comMeta.filter(p => calcPct(p.real,p.meta) < 50);
    const amarelos  = comMeta.filter(p => { const pct = calcPct(p.real,p.meta); return pct >= 50 && pct < 80; });
    const verdes    = comMeta.filter(p => calcPct(p.real,p.meta) >= 80);

    // Insight
    const maiorDiaria = [...comMeta].sort((a,b) => calcDiaria(b.meta,b.real,dias) - calcDiaria(a.meta,a.real,dias))[0];
    document.getElementById('insightAtencao').innerHTML = `
        <div class="insight-card" style="border-left-color:#ef4444;">
            <div class="i-label">ğŸ”´ Risco alto (< 50%)</div>
            <div class="i-val" style="color:#ef4444;">${vermelhos.length}</div>
            <div class="i-name">promotores</div>
        </div>
        <div class="insight-card" style="border-left-color:#f59e0b;">
            <div class="i-label">ğŸŸ¡ AtenÃ§Ã£o (50â€“79%)</div>
            <div class="i-val" style="color:#f59e0b;">${amarelos.length}</div>
            <div class="i-name">promotores</div>
        </div>
        <div class="insight-card" style="border-left-color:#10b981;">
            <div class="i-label">ğŸŸ¢ No caminho (â‰¥80%)</div>
            <div class="i-val" style="color:#10b981;">${verdes.length}</div>
            <div class="i-name">promotores</div>
        </div>
        <div class="insight-card" style="border-left-color:#6366f1;">
            <div class="i-label">âš¡ Maior diÃ¡ria necessÃ¡ria</div>
            <div class="i-val" style="color:#6366f1;">${calcDiaria(maiorDiaria?.meta,maiorDiaria?.real,dias)}</div>
            <div class="i-name">${maiorDiaria ? primeiroNome(maiorDiaria.nome) : 'â€”'}</div>
        </div>`;

    // Mostra todos ordenados por pior pct
    const allSorted = [...comMeta].sort((a,b) => calcPct(a.real,a.meta) - calcPct(b.real,b.meta));
    const labels  = allSorted.map(p => primeiroNome(p.nome));
    const pcts    = allSorted.map(p => calcPct(p.real, p.meta));
    const diarias = allSorted.map(p => calcDiaria(p.meta, p.real, dias));
    const bgColors = pcts.map(p => p < 50 ? 'rgba(239,68,68,0.8)' : p < 80 ? 'rgba(245,158,11,0.8)' : 'rgba(16,185,129,0.8)');

    chartInstances['chartAtencao'] = new Chart(
        document.getElementById('chartAtencao'),
        {
            type: 'bar',
            data: {
                labels,
                datasets: [
                    {
                        label: '% Atingimento',
                        data: pcts,
                        backgroundColor: bgColors,
                        borderRadius: 5,
                        borderSkipped: false,
                        yAxisID: 'y'
                    },
                    {
                        label: 'DiÃ¡ria necessÃ¡ria',
                        data: diarias,
                        type: 'line',
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99,102,241,0.1)',
                        pointBackgroundColor: '#6366f1',
                        pointRadius: 4,
                        tension: 0.3,
                        yAxisID: 'y2'
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top', labels: { font: { size: 10 }, boxWidth: 12 } },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: Math.max(120, ...pcts),
                        ticks: { callback: v => v + '%', font: { size: 10 } },
                        grid: { color: '#f1f5f9' }
                    },
                    y2: {
                        position: 'right',
                        beginAtZero: true,
                        ticks: { font: { size: 10 } },
                        grid: { drawOnChartArea: false }
                    },
                    x: { ticks: { font: { size: 9 } }, grid: { display: false } }
                }
            }
        }
    );
}

// â”€â”€ GRÃFICO PRODUTOS â”€â”€
function buildChartProdutos() {
    destroyChart('chartProdDonut');
    destroyChart('chartProdBar');

    const comMeta = fenixData.promotores.filter(p => p.meta > 0);
    const realTotal = fenixData.promotores.reduce((a,b) => a+(b.real||0),0);
    const renoTotal = fenixData.promotores.reduce((a,b) => a+(b.reno||0),0);
    const a5Total   = fenixData.promotores.reduce((a,b) => a+(b.a5||0),0);
    const outros    = Math.max(0, realTotal - renoTotal - a5Total);

    const metaReno = fenixData.metaReno || 69;
    const metaA5   = fenixData.metaA5   || 69;

    // Insights
    const topReno = [...fenixData.promotores]
        .filter(p => (p.reno||0) > 0)
        .sort((a,b) => (b.reno||0) - (a.reno||0))[0] || null;
    const topA5   = [...fenixData.promotores]
        .filter(p => (p.a5||0) > 0)
        .sort((a,b) => (b.a5||0) - (a.a5||0))[0] || null;
    document.getElementById('insightProd').innerHTML = `
        <div class="insight-card" style="border-left-color:var(--reno);">
            <div class="i-label">ğŸ”¥ Reno total</div>
            <div class="i-val" style="color:var(--reno);">${renoTotal} <small style="font-size:13px;font-weight:700;">(${calcPct(renoTotal,metaReno)}%)</small></div>
            <div class="i-name">de ${metaReno} na meta</div>
        </div>
        <div class="insight-card" style="border-left-color:var(--a5pro);">
            <div class="i-label">ğŸ’ A5 Pro total</div>
            <div class="i-val" style="color:var(--a5pro);">${a5Total} <small style="font-size:13px;font-weight:700;">(${calcPct(a5Total,metaA5)}%)</small></div>
            <div class="i-name">de ${metaA5} na meta</div>
        </div>
        <div class="insight-card" style="border-left-color:var(--reno);">
            <div class="i-label">â­ Top Reno</div>
            <div class="i-val" style="color:var(--reno);">${topReno?.reno || 0}</div>
            <div class="i-name">${topReno ? primeiroNome(topReno.nome) : 'â€”'}</div>
        </div>
        <div class="insight-card" style="border-left-color:var(--a5pro);">
            <div class="i-label">â­ Top A5 Pro</div>
            <div class="i-val" style="color:var(--a5pro);">${topA5?.a5 || 0}</div>
            <div class="i-name">${topA5 ? primeiroNome(topA5.nome) : 'â€”'}</div>
        </div>`;

    // Donut
    chartInstances['chartProdDonut'] = new Chart(
        document.getElementById('chartProdDonut'),
        {
            type: 'doughnut',
            data: {
                labels: ['Reno', 'A5 Pro', 'Outros'],
                datasets: [{
                    data: [renoTotal, a5Total, outros],
                    backgroundColor: ['#f97316','#06b6d4','#6366f1'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: { position: 'bottom', labels: { font: { size: 11 }, boxWidth: 12 } },
                    tooltip: { callbacks: { label: ctx => ` ${ctx.label}: ${ctx.parsed} unid.` } }
                }
            }
        }
    );

    // Barra Reno + A5 por promotor (top 8 por soma reno+a5)
    const top8 = [...comMeta]
        .sort((a,b) => ((b.reno||0)+(b.a5||0)) - ((a.reno||0)+(a.a5||0)))
        .slice(0,8);

    chartInstances['chartProdBar'] = new Chart(
        document.getElementById('chartProdBar'),
        {
            type: 'bar',
            data: {
                labels: top8.map(p => primeiroNome(p.nome)),
                datasets: [
                    { label: 'Reno',   data: top8.map(p => p.reno||0), backgroundColor: '#f97316', borderRadius: 4 },
                    { label: 'A5 Pro', data: top8.map(p => p.a5||0),   backgroundColor: '#06b6d4', borderRadius: 4 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'top', labels: { font: { size: 10 }, boxWidth: 12 } } },
                scales: {
                    x: { stacked: false, ticks: { font: { size: 9 } }, grid: { display: false } },
                    y: { beginAtZero: true, ticks: { font: { size: 10 } }, grid: { color: '#f1f5f9' } }
                }
            }
        }
    );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER PRINCIPAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
    const dias      = getDiasUteisRestantes();
    const realTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.real)||0), 0);
    const renoTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.reno)||0), 0);
    const a5Total   = fenixData.promotores.reduce((a,b) => a+(parseInt(b.a5)||0),   0);
    const capaTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.capa)||0), 0);
    const metaTotal = fenixData.promotores.reduce((a,b) => a+(parseInt(b.meta)||0), 0);

    document.getElementById("realGeral").innerText   = realTotal;
    document.getElementById("renoGeral").innerText   = renoTotal;
    document.getElementById("a5Geral").innerText     = a5Total;
    // Market share = real / CAPA total (penetraÃ§Ã£o da carteira)
    document.getElementById("marketGeral").innerText = calcPct(realTotal, capaTotal) + "%";
    // Atingimento geral = real / meta geral da equipe
    document.getElementById("pctGeral").innerText    = calcPct(realTotal, fenixData.metaGeral || 629) + "%";
    // DiÃ¡ria da equipe
    document.getElementById("diariaEquipe").innerText = calcDiaria(fenixData.metaGeral || 629, realTotal, dias);
    // Metas nos cards
    document.getElementById("metaGeralLabel").innerText = fenixData.metaGeral || 629;
    document.getElementById("metaRenoLabel").innerText  = fenixData.metaReno  || 69;
    document.getElementById("metaA5Label").innerText    = fenixData.metaA5    || 69;

    const sorted    = [...fenixData.promotores].sort((a,b) => scoreRanking(b,dias) - scoreRanking(a,dias));
    const rankClass = ['rank-1','rank-2','rank-3'];
    const rankEmoji = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];

    let medalIdx = 0, html = "";
    sorted.forEach((p, idx) => {
        const semMeta = !p.meta || p.meta === 0;
        const pct     = calcPct(p.real, p.meta);
        const dRest   = calcDiaria(p.meta, p.real, dias);

        const corBarra  = semMeta ? "#e2e8f0"
                        : pct >= 100 ? "var(--success-dark)"
                        : pct >= 70  ? "var(--primary)"
                        : pct >= 50  ? "var(--warning)"
                        : "var(--danger)";

        const corDiaria = dRest <= 1 ? "var(--success)"
                        : dRest <= 3 ? "var(--warning)"
                        : "var(--danger)";

        let badgeClass, badgeConteudo;
        if (semMeta) {
            badgeClass = 'rank-n'; badgeConteudo = `${idx+1}Âº`;
        } else {
            badgeClass    = medalIdx < 3 ? rankClass[medalIdx] : 'rank-n';
            badgeConteudo = medalIdx < 3 ? rankEmoji[medalIdx] : `${idx+1}Âº`;
            medalIdx++;
        }

        html += `<div class="promotor-card" style="border-left-color:${corBarra}">
            <div class="rank-badge ${badgeClass}">${badgeConteudo}</div>
            <div>
                <div class="p-name">${p.nome}</div>
                <div class="p-capa">CAPA ${p.capa}</div>
            </div>
            <div>
                <div class="progress-bg">
                    <div class="progress-fill" style="width:${Math.min(pct,100)}%;background:${corBarra}"></div>
                </div>
                <div class="pct-label" style="color:${corBarra}">${pct}% DA META</div>
            </div>
            <div class="meta-group">
                <div class="m-item"><span>Meta</span><b>${p.meta}</b></div>
                <div class="m-item"><span>Real</span><b>${p.real}</b></div>
                <div class="m-item"><span>Dia</span><b style="color:${corDiaria}">${dRest}</b></div>
            </div>
        </div>`;
    });

    document.getElementById("listaPromotores").innerHTML = html;
}

render();

// Inicia sincronizaÃ§Ã£o Firebase (aguarda SDK carregar)
if (window._firebaseReady) {
    setupFirebaseSync();
} else {
    window.addEventListener('firebaseReady', setupFirebaseSync);
}
</script>
</body>
</html>
